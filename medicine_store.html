<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>excel</title>
<!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"> </script> -->
<script src="jquery.min.js"> </script>
<!-- To enable xml reading from local file in chrome run the below command on cmd in windows at the location where chrome is installed -->
<!-- C:\Program Files (x86)\Google\Chrome\Application>chrome.exe --allow-file-access-from-files-->
<script type="text/javascript">
function calculateFinalPrice(selectObject) {
  itemIdIndex = selectObject.id.split('_').pop();
  total_price = ($('#medicine_'+itemIdIndex).val() * $('#quantity_'+itemIdIndex).val());
  $('#total_price_'+itemIdIndex).text(total_price);
  final_price = (total_price * (1 - $('#discount_percent_'+itemIdIndex).val()/100)).toFixed(2)
  $('#final_price_'+itemIdIndex).text(final_price);
  $('#mrp_'+itemIdIndex).text($('#medicine_'+itemIdIndex).val());
  $('#discount_'+itemIdIndex).text((total_price - final_price).toFixed(2));
  generateFinalAmount();
}

function generateFinalAmount() {
  var total_amount = 0;
  $("[name='total_price']").each( function( i , e ) {
      var v = parseInt( $( e ).text() );
      console.log(v);
      if ( !isNaN( v ) )
          total_amount += v;
  } );
  var total_discount_value = 0;
  $("[name='discount']").each( function( i , e ) {
      var v = parseInt( $( e ).text() );
      if ( !isNaN( v ) )
          total_discount_value += v;
  } );
  var total_amount_payable = 0;
  $("[name='final_price']").each( function( i , e ) {
      var v = parseInt( $( e ).text() );
      if ( !isNaN( v ) )
          total_amount_payable += v;
  } );
  $('#total_amount').text(total_amount);
  $('#total_discount_value').text(total_discount_value);
  $('#total_amount_payable').text(total_amount_payable);
}

function updateAllDiscounts() {
  $("[name='discount_percent']").val($('#discount_percent_main').val()).change();
}

function addNewItem() {
  var newId = $('#medicine_table tr').length;
  $('#medicine_table').append($('#newItemTemplate tr').clone());
  $('#medicine_table #medicine_').attr('id',"medicine_"+newId);
  $('#medicine_table #mrp_').attr('id',"mrp_"+newId);
  $('#medicine_table #quantity_').attr('id',"quantity_"+newId);
  $('#medicine_table #discount_percent_').attr('id',"discount_percent_"+newId);
  $('#medicine_table #total_price_').attr('id',"total_price_"+newId);
  $('#medicine_table #final_price_').attr('id',"final_price_"+newId);
  $('#medicine_table #discount_').attr('id',"discount_"+newId);
}

function deleteItem(selectObject) {
  selectObject.closest('tr').remove();
  generateFinalAmount()
}

</script>
<style type="text/css">
  table {
    width: 100%;
  }
  table, th, td {
    border: 1px solid black;
  }
</style>
</head>
<body style="">
	<div id="container">
<div id="newItemTemplate" style="display: none;">
  <table>
    <tr>
      <td>
        <select name="medicine" id="medicine_" onChange="calculateFinalPrice(this);">
          <option value="0">Select Medicine</option>
          <option value="8.5">TABDOZ SP</option>
          <option value="125">SYP OXCEE PLUS</option>
          <option value="26.5">BIOXIB TH</option>
          <option value="11">CALCILON</option>
          <option value="7.8">BIOXIB 90</option>
        </select>
      </td>
      <td name="mrp" id="mrp_">
      </td>
      <td>
        <input type="textfield" name="quantity" id="quantity_" onChange="calculateFinalPrice(this);">
      </td>
      <td name="total_price" id="total_price_"></td>
      <td>
        <select name="discount_percent" id="discount_percent_" onChange="calculateFinalPrice(this);">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="15">15</option>
          <option value="20">20</option>
        </select>
      </td>
      <td name="discount" id="discount_"></td>
      <td name="final_price" id="final_price_"></td>
      <td>
        <button name="deleteItem" onclick="deleteItem(this);">Delete</button><br>
      </td>
    </tr>
  </table>
</div>

<button style="width: 500px;" onclick="addNewItem();">Add New Item</button><br>
<table id="medicine_table">
  <tr>
    <th>Medicine</th>
    <th>MRP</th>
    <th>Quantity</th>
    <th>Total Price</th>
    <th>Discount % <select name="discount_percent_main" id="discount_percent_main" onChange="updateAllDiscounts();">
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="15">15</option>
        <option value="20">20</option>
      </select></th>
    <th>Discount</th>
    <th>Amount</th>
    <th>Action</th>
  </tr>
</table>
<br><br>
<table>
  <tr>
    <th>Total Amount</th>
    <th>Discount</th>
    <th>Amount Payable</th>
  </tr>
  <tr>
    <td id="total_amount"></td>
    <td id="total_discount_value"></td>
    <td id="total_amount_payable"></td>
  </tr>
</table>

</div><br>

</body>
</html>
